upstream live-monitor-node.pollux.box{
	server live-monitor.pollux.box:4000;
}

upstream live-monitor-node-rest.pollux.box{
	server live-monitor.pollux.box:4001;
}

#upstream live-monitor-node-rest.pollux{
#	server live-monitor.pollux.box:4001;
#}

server {
	listen 80;
  large_client_header_buffers 4 64k;
	server_name live-monitor.pollux.box;
	access_log /var/log/nginx/live-monitor.pollux.box.log;
	error_log /var/log/nginx/live-monitor-error.pollux.box.log;

	root /usr/home/jvazquez/live-monitor/;

  location / {
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_set_header X-NginX-Proxy true;

      proxy_pass http://live-monitor-node.pollux.box/;

      proxy_redirect off;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
  }

	location /channel{
			set $cors '';

			if ($http_origin ~* 'http://live-monitor-client.pollux.box') {
				set $cors 'true';
			}

			if ($cors = 'true'){
				add_header "Access-Control-Allow-Origin" "$http_origin";
    		add_header "Access-Control-Allow-Methods" "GET, POST, PUT, DELETE, HEAD";
    		add_header "Access-Control-Allow-Headers"  "x-requested-with";
			}

			proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_set_header X-NginX-Proxy true;
      proxy_pass http://live-monitor-node-rest.pollux.box;
      proxy_redirect off;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
		}

#	location /channel{
#      proxy_set_header X-Real-IP $remote_addr;
#      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#      proxy_set_header Host $http_host;
#      proxy_set_header X-NginX-Proxy true;
#
#      proxy_pass http://live-monitor-node-rest.pollux;
#
#
#      proxy_redirect off;
#			proxy_http_version 1.1;
#			proxy_set_header Upgrade $http_upgrade;
#			proxy_set_header Connection "upgrade";
#
#			set $cors '';
#			if ($http_origin ~* 'http://live-monitor-client.pollux.box') {
#				set $cors 'true';
#			}
#
#			if ($cors = 'true'){
#				add_header 'Access-Control-Allow-Origin' "$http_origin";
#    		add_header 'Access-Control-Allow-Methods' "GET, POST, PUT, DELETE, HEAD";
#    		add_header 'Access-Control-Allow-Headers' "x-requested-with";
#			}
#	}

}	
